 <!DOCTYPE html>
 <html>
 <head>
   <title>Product Details</title>
   <link rel="stylesheet" href="Style/product.css">
 </head>

<body>
  <h1>Product Details</h1>
  <!-- Total Quantity Button -->
  <button id="totalQuantityButton" data-bind="click: viewCart">
    Cart (<span data-bind="text: totalQuantity"></span>)
  </button>
  
  <div>
    <h3 data-bind="text: productName"></h3>
    <p data-bind="text: productDescription"> </p>
    <p data-bind="text: productPrice"></p>
    <img data-bind="attr: { src: productImage }" width="200" height="100">
    <input class="quantity" type="number" min="1" data-bind="value: productQuantity, valueUpdate: 'input'">
    <button class="addcart" data-bind="click: addToCart">Add to Cart</button>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.1/knockout-latest.js"></script>
  <script>
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const productName = urlParams.get('name');
    const productDescription = urlParams.get('description');
    const productPrice = urlParams.get('price');
    const productImage = urlParams.get('image');
    const productQuantity = ko.observable(urlParams.get('quantity') || 0);
     const totalQuantity = ko.observable(localStorage.getItem('totalQuantity') || 0);
    var someData = localStorage.getItem('cart');
   

    function ProductDetailsViewModel() {
      var self = this;
      self.productName = ko.observable(productName);
      self.productDescription = ko.observable(productDescription);
      self.productPrice = ko.observable(productPrice);
      self.productImage = ko.observable(productImage);
      self.productQuantity = productQuantity;
      self.totalQuantity = totalQuantity;
      
      // Calculate total amount
      self.totalAmount = ko.computed(function() {
        return parseFloat(self.productPrice()) * parseFloat(self.productQuantity());
      });
      // Subscribe to productQuantity changes to update totalQuantity
      self.productQuantity.subscribe(function(newQuantity) {
        var addedQuantity = parseInt(newQuantity) || 0;
        self.totalQuantity(addedQuantity + parseInt(totalQuantity()));
      });
      
      self.addToCart = function () {
        var cartData = localStorage.getItem('cart');
        var cartItems = cartData ? JSON.parse(cartData) : [];

        var existingItem = cartItems.find(item => item.name === self.productName());

        if (existingItem) {
          existingItem.quantity = parseInt(self.productQuantity());

        } else {
          cartItems.push({
            name: self.productName(),
            price: self.productPrice(),
            image: self.productImage(),
            quantity: parseInt(self.productQuantity())
          });
        }

        localStorage.setItem('totalQuantity', self.totalQuantity() + parseInt(self.productQuantity()));
        localStorage.setItem('cart', JSON.stringify(cartItems));
      };

      self.viewCart = function () {
        window.location.href = 'cart1.html';
      };
    }
    
    ko.applyBindings(new ProductDetailsViewModel());
  </script>
</body>
</html>
